<che-row-toolbar
  title="{{workspaceDetailsController.isCreationFlow ? 'New Workspace' : workspaceDetailsController.workspaceName}}"
  link-href="#/workspaces" link-title="Workspaces" class="workspace-details-toolbar">
  <div layout="row" layout-align="start center" class="toolbar-info">
    <workspace-status che-status="workspaceDetailsController.getWorkspaceStatus()"></workspace-status>
  </div>
  <div flex layout="row" layout-align="end center">
    <workspace-status-button workspace-status="workspaceDetailsController.getWorkspaceStatus()"
                             on-stop-workspace="workspaceDetailsController.stopWorkspace(isCreateSnapshot)"
                             on-run-workspace="workspaceDetailsController.runWorkspace()"></workspace-status-button>
    <che-button-default ng-if="workspaceDetailsController.editMode === false"
                        che-button-title="Open"
                        href="#/ide/{{workspaceDetailsController.namespaceId}}/{{workspaceDetailsController.workspaceName}}"></che-button-default>
  </div>
</che-row-toolbar>

<md-progress-linear md-mode="indeterminate" ng-show="workspaceDetailsController.loading"></md-progress-linear>

<md-content md-scroll-y flex
            class="workspace-details-content" md-theme="default">
  <md-tabs md-dynamic-height md-stretch-tabs="auto"
           md-selected="workspaceDetailsController.selectedTabIndex"
           md-no-ink-bar>

    <!-- Overview tab -->
    <md-tab md-on-select="workspaceDetailsController.onSelectTab(workspaceDetailsController.tab.Overview);">
      <md-tab-label>
        <i ng-show="workspaceDetailsController.checkFormsNotValid(workspaceDetailsController.tab.Overview)"
           class="error-state fa fa-exclamation-circle" aria-hidden="true"></i>
        <span class="che-tab-label-title">Overview</span>
      </md-tab-label>
      <md-tab-body>
        <ng-form name="workspaceOverviewForm">
          <workspace-details-overview ng-if="workspaceDetailsController.workspaceDetails"
                                      ng-init="workspaceDetailsController.setForm(workspaceDetailsController.tab.Overview, workspaceOverviewForm)"
                                      overview-form="workspaceOverviewForm"
                                      on-change="workspaceDetailsController.switchEditMode()"
                                      workspace-details="workspaceDetailsController.workspaceDetails"></workspace-details-overview>
        </ng-form>
      </md-tab-body>
    </md-tab>

    <!-- Projects tab -->
    <md-tab md-on-select="workspaceDetailsController.onSelectTab(workspaceDetailsController.tab.Projects);">
      <md-tab-label>
        <span class="che-tab-label-title">Projects</span>
      </md-tab-label>
      <md-tab-body>
        <workspace-details-projects
          workspace-details="workspaceDetailsController.workspaceDetails"
          projects-on-change="workspaceDetailsController.switchEditMode()"></workspace-details-projects>
      </md-tab-body>
    </md-tab>

    <!-- Machines tab -->
    <md-tab md-on-select="workspaceDetailsController.onSelectTab(workspaceDetailsController.tab.Machines);">
      <md-tab-label>
        <span class="che-tab-label-title">Machines</span>
      </md-tab-label>
      <md-tab-body>
        <workspace-machines workspace-details="workspaceDetailsController.workspaceDetails"
                            workspace-on-change="workspaceDetailsController.switchEditMode()"></workspace-machines>
      </md-tab-body>
    </md-tab>

    <!-- Agents -->
    <md-tab md-on-select="workspaceDetailsController.onSelectTab(workspaceDetailsController.tab.Agents);">
      <md-tab-label>
        <span class="che-tab-label-title">Agents</span>
      </md-tab-label>
      <md-tab-body>
        <che-machine-selector content-title="Workspace Agents"
                              workspace-details="workspaceDetailsController.workspaceDetails"
                              on-change="workspaceDetailsController.switchEditMode()">
          <che-machine-agents environment-manager="environmentManager"
                              selected-machine="machine"
                              on-change="onChange()"></che-machine-agents>
        </che-machine-selector>
      </md-tab-body>
    </md-tab>

    <!-- Servers -->
    <md-tab md-on-select="workspaceDetailsController.onSelectTab(workspaceDetailsController.tab.Servers);">
      <md-tab-label>
        <span class="che-tab-label-title">Servers</span>
      </md-tab-label>
      <md-tab-body>
        <che-machine-selector content-title="Servers"
                              workspace-details="workspaceDetailsController.workspaceDetails"
                              on-change="workspaceDetailsController.switchEditMode()">
          <che-machine-servers environment-manager="environmentManager"
                               selected-machine="machine"
                               on-change="onChange()"></che-machine-servers>
        </che-machine-selector>
      </md-tab-body>
    </md-tab>

    <!-- Env Variables -->
    <md-tab md-on-select="workspaceDetailsController.onSelectTab(workspaceDetailsController.tab.Env_Variables);">
      <md-tab-label>
        <span class="che-tab-label-title">Env Variables</span>
      </md-tab-label>
      <md-tab-body>
        <che-machine-selector content-title="Environment variables"
                              workspace-details="workspaceDetailsController.workspaceDetails"
                              on-change="workspaceDetailsController.switchEditMode()">
          <che-env-variables environment-manager="environmentManager"
                             selected-machine="machine"
                             on-change="onChange()"></che-env-variables>
        </che-machine-selector>
      </md-tab-body>
    </md-tab>

    <!-- Config tab -->
    <md-tab md-on-select="workspaceDetailsController.onSelectTab(workspaceDetailsController.tab.Config);">
      <md-tab-label>
        <i ng-show="workspaceDetailsController.checkFormsNotValid(workspaceDetailsController.tab.Config)"
           class="error-state fa fa-exclamation-circle" aria-hidden="true"></i>
        <span class="che-tab-label-title">Config</span>
      </md-tab-label>
      <md-tab-body>
        <che-label-container che-label-name="Workspace">
          <ng-form name="workspaceConfigForm">
            <che-workspace-config-import
              ng-init="workspaceDetailsController.setForm(workspaceDetailsController.tab.Config, workspaceConfigForm)"
              workspace-config="workspaceDetailsController.workspaceDetails.config"
              workspace-config-on-change="workspaceDetailsController.updateWorkspaceConfigImport(config)"></che-workspace-config-import>
          </ng-form>
        </che-label-container>
      </md-tab-body>
    </md-tab>

    <!-- Other tabs -->
    <md-tab ng-repeat="section in workspaceDetailsController.getPages()"
            ng-if="workspaceDetailsController.isCreationFlow === false"
            ng-init="workspaceDetailsController.addTab(section.title);"
            md-on-select="workspaceDetailsController.onSelectTab(workspaceDetailsController.tab[section.title]);">
      <md-tab-label>
        <span class="che-tab-label-title">{{section.title}}</span>
      </md-tab-label>
      <md-tab-body>
        <div che-compile="section.content"></div>
      </md-tab-body>
    </md-tab>
  </md-tabs>
</md-content>

<workspace-edit-mode-overlay ng-if="workspaceDetailsController.editMode"
                             workspace-edit-mode-message="{{workspaceDetailsController.editModeMessage}}"
                             workspace-edit-mode-show-message="workspaceDetailsController.showApplyMessage"
                             workspace-edit-disable-save-button="workspaceDetailsController.isSaveButtonDisabled()"
                             workspace-edit-mode-on-save="workspaceDetailsController.saveWorkspace()"
                             workspace-edit-mode-on-cancel="workspaceDetailsController.cancelConfigChanges()"></workspace-edit-mode-overlay>

<md-content ng-show="workspaceDetailsController.invalidWorkspace">{{workspaceDetailsController.invalidWorkspace}}
</md-content>
